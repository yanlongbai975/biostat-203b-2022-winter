---
title: "Biostat 203B Homework 1"
author: YANLONG BAI
subtitle: Due Jan 21 @ 11:59PM
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Display machine information for reproducibility:
```{r, eval=F}
sessionInfo()
```

## Q1. Git/GitHub

**No handwritten homework reports are accepted for this course.** We work with Git and GitHub. Efficient and abundant use of Git, e.g., frequent and well-documented commits, is an important criterion for grading your homework.

1. Apply for the [Student Developer Pack](https://education.github.com/pack) at GitHub using your UCLA email. You'll get GitHub Pro account for free (unlimited public and private repositories).

2. Create a **private** repository `biostat-203b-2022-winter` and add `Hua-Zhou` and `maschepps` as your collaborators with write permission.

3. Top directories of the repository should be `hw1`, `hw2`, ... Maintain two branches `main` and `develop`. The `develop` branch will be your main playground, the place where you develop solution (code) to homework problems and write up report. The `main` branch will be your presentation area. Submit your homework files (R markdown file `Rmd`, `html` file converted from R markdown, all code and extra data sets to reproduce results) in `main` branch.

4. After each homework due date, teaching assistant and instructor will check out your main branch for grading. Tag each of your homework submissions with tag names `hw1`, `hw2`, ... Tagging time will be used as your submission time. That means if you tag your `hw1` submission after deadline, penalty points will be deducted for late submission.

5. After this course, you can make this repository public and use it to demonstrate your skill sets on job market.

## Q2. Data ethics training

This exercise (and later in this course) uses the [MIMIC-IV data](https://mimic-iv.mit.edu), a freely accessible critical care database developed by the MIT Lab for Computational Physiology. Follow the instructions at <https://mimic.mit.edu/docs/gettingstarted/> to 

(1) complete the CITI `Data or Specimens Only Research` course.

### Answers

**Completion report link**: 
https://www.citiprogram.org/verify/?k703f8137-96c1-484d-bc50-f8ff9ab1d214-46671395

**Completion certificate link**:
https://www.citiprogram.org/verify/?w3555116b-f653-4ad0-a71d-cdac98ee9677-46671395

(2) obtain the PhysioNet credential for using the MIMIC-IV data. Display the verification links to your completion report and completion certificate here. (Hint: The CITI training takes a couple hours and the PhysioNet credentialing takes a couple days; do not leave it to the last minute.)

**Still being processed.**

## Q3. Linux Shell Commands

1. The `/mnt/mimiciv/1.0` folder on teaching server contains data sets from MIMIC-IV. Refer to the documentation <https://mimic.mit.edu/docs/iv/> for details of data files.  
    ```{bash}
    ls -l /mnt/mimiciv/1.0
    ```
Please, do **not** put these data files into Git; they are big. Do **not** copy them into your directory. Do **not** decompress the gz data files. These create unnecessary big files on storage and are not big data friendly practices. Just read from the data folder `/mnt/mimiciv/1.0` directly in following exercises. 

### Answers

```{bash}
ls -al -1 /mnt/mimiciv/1.0/
```
    
    Use Bash commands to answer following questions.

2. Display the contents in the folders `core`, `hosp`, `icu`. Why are these data files distributed as `.csv.gz` files instead of `.csv` (comma separated values) files? Read the page <https://mimic.mit.edu/docs/iv/> to understand what's in each folder.

### Answers

```{bash}
ls -al -1 /mnt/mimiciv/1.0/core
```

```{bash}
ls -al -1 /mnt/mimiciv/1.0/hosp
```

```{bash}
ls -al -1 /mnt/mimiciv/1.0/icu
```

**Reason for `.csv.gz` file type: Firstly, those data are really large, so they 
have been compressed with gzip utility. Secondly, those data are not publicly
available and the structure is subject to change, so the author compressed them.
**

3. Briefly describe what bash commands `zcat`, `zless`, `zmore`, and `zgrep` do.

### Answer

**`zcat` command will recall the `Gzip`, which will reduce the size of the 
named files using Lempel-Ziv coding (LZ77). Whenever possible, each file is 
replaced by one with the extension `.gz`, while keeping the same ownership modes
, access and modification times. Briefly, this command can be regarded as 
command `cat` specified for compressed files.**

**`zless` is a filter which allows examination of compressed or plain text
files one screenful at a time on a soft-copy terminal. Briefly, it can be 
regarded as command `less` specified for compressed files.**

**`zmore` is a filter which allows examination of compressed or plain text 
files one screenful at a time on a soft-copy terminal. Briefly, it can be 
regarded as command `more` specified for compressed files.**

**`zgrep` invokes `grep` on compressed or gzipped files.**

4. What's the output of following bash script?
    ```{bash, eval=F}
    for datafile in /mnt/mimiciv/1.0/core/*.gz
      do
        ls -l $datafile
      done
    ```
    
### Answer

**The output is each file's permissions, type, edit time and name, just like 
following output.**
```{bash}
for datafile in /mnt/mimiciv/1.0/core/*.gz
      do
        ls -l $datafile
      done
```
    
Display the number of lines in each data file using a similar loop.

```{bash}
for datafile in /mnt/mimiciv/1.0/core/*.gz
      do
        gzip -cd $datafile | wc -l
      done
```

5. Display the first few lines of `admissions.csv.gz`. How many rows are in this data file? How many unique patients (identified by `subject_id`) are in this data file? (Hint: combine Linux commands `zcat`, `head`/`tail`, `awk`, `sort`, `uniq`, `wc`, and so on.)

### Answer

```{bash}
gzip -cd /mnt/mimiciv/1.0/core/admissions.csv.gz |
awk 'NR > 1 {print}' | head -10
echo Unique patients number:
gzip -cd /mnt/mimiciv/1.0/core/admissions.csv.gz | wc -l
```

```{bash}
gzip -cd /mnt/mimiciv/1.0/core/admissions.csv.gz |
awk -F: '{FS=","} {print $1}'| sort -u | wc -l
```


6. What are the possible values taken by each of the variable `admission_type`, `admission_location`, `insurance`, and `ethnicity`? Also report the count for each unique value of these variables. (Hint: combine Linux commands `zcat`, `head`/`tail`, `awk`, `uniq -c`, `wc`, and so on.)

### Answer

`admission_type`

```{bash}
gzip -cd /mnt/mimiciv/1.0/core/admissions.csv.gz |
awk -F: '{FS=","} {print $6}'| sort -u | wc -l
gzip -cd /mnt/mimiciv/1.0/core/admissions.csv.gz |
awk -F: '{FS=","} {print $6}'| sort -u 
```

`admission_location`

```{bash}
gzip -cd /mnt/mimiciv/1.0/core/admissions.csv.gz |
awk -F: '{FS=","} {print $7}'| sort -u | wc -l
gzip -cd /mnt/mimiciv/1.0/core/admissions.csv.gz |
awk -F: '{FS=","} {print $7}'| sort -u
```

`insurance`

```{bash}
gzip -cd /mnt/mimiciv/1.0/core/admissions.csv.gz |
awk -F: '{FS=","} {print $9}'| sort -u | wc -l
gzip -cd /mnt/mimiciv/1.0/core/admissions.csv.gz |
awk -F: '{FS=","} {print $9}'| sort -u
```

`ethnicity`

```{bash}
gzip -cd /mnt/mimiciv/1.0/core/admissions.csv.gz |
awk -F: '{FS=","} {print $12}'| sort -u | wc -l
gzip -cd /mnt/mimiciv/1.0/core/admissions.csv.gz |
awk -F: '{FS=","} {print $12}'| sort -u
```

## Q4. Who's popular in Price and Prejudice

1. You and your friend just have finished reading *Pride and Prejudice* by Jane Austen. Among the four main characters in the book, Elizabeth, Jane, Lydia, and Darcy, your friend thinks that Darcy was the most mentioned. You, however, are certain it was Elizabeth. Obtain the full text of the novel from <http://www.gutenberg.org/cache/epub/42671/pg42671.txt> and save to your local folder. 
    ```{bash, eval=FALSE}
    wget -nc http://www.gutenberg.org/cache/epub/42671/pg42671.txt
    ```
Explain what `wget -nc` does. 

### Answer

**`wget` is a free utility for non-interactive download of files from the Web. 
`-nc` means 'no-clobber', when `-nc` is specified, downloading the same file 
in the same directory will be refused.**

Do **not** put this text file `pg42671.txt` in Git. Complete the following loop to tabulate the number of times each of the four characters is mentioned using Linux commands.

### Answer

```{bash}
    wget -nc http://www.gutenberg.org/cache/epub/42671/pg42671.txt
    for char in Elizabeth Jane Lydia Darcy
    do
      echo $char:
      grep -o $char pg42671.txt | wc -l
    done
```
    
2. What's the difference between the following two commands?
    ```{bash eval=FALSE}
    echo 'hello, world' > test1.txt
    ```
   and
    ```{bash eval=FALSE}
    echo 'hello, world' >> test2.txt
    ```
    
### Answer

**`>` is used to save the 'hello, world' to the specified file 'test1.txt' and
replace the original contents with the new one.**

**`>>` is used to save the 'hello, world' to the specified file 'test1.txt' but
just add the new contents to the file without editing the original contents.**

3. Using your favorite text editor (e.g., `vi`), type the following and save the file as `middle.sh`:
    ```{bash eval=FALSE}
    #!/bin/sh
    # Select lines from the middle of a file.
    # Usage: bash middle.sh filename end_line num_lines
    head -n "$2" "$1" | tail -n "$3"
    ```

### Answer

**For this question, I can only type those words in vim editor by hand, or do 
the following code line by line in the terminal, because I can't type `^[` in
this markdown file. When you try to do this, press the `control` key, `-` key 
and `v` key together, then release them, and press the `ESC` key, then you will
get a standard `^[`, not the combination of `^` and `[`. Notice that each line
in EE (from i to :wq) has a space ahead of the content. But still some words may
not be typed in the 'middle.sh', so the best way is to type those words by 
hands.**

**So please download the file 'middle.sh' in this directory and change the 
following path to the way in your computer, thank you so much.**

```{bash eval=FALSE}
vim middle.sh << EE
 i
 #!/bin/sh
 # Select lines from the middle of a file.
 # Usage: bash middle.sh filename end_line num_lines
 head -n "$2" "$1" | tail -n "$3"
 ^[
 :wq
EE
```
    
Using `chmod` make the file executable by the owner, and run 
    ```{bash eval=FALSE}
    
    ./middle.sh pg42671.txt 20 5
    ```
Explain the output. Explain the meaning of `"$1"`, `"$2"`, and `"$3"` in this shell script. Why do we need the first line of the shell script?

### Answer

```{bash}
chmod 751 middle.sh
./middle.sh pg42671.txt 20 5
```

**The output is the result from 'middle.sh' executing on the file 
'pg42671.txt', the actual form of this command should be 'head -n 20 
pg42671.txt | tail -n 5'. Here `$1` means put the first input following the 
`./middle.sh` at the position of `$1` , similarly for `$2` and `$3`. To be more
specific, here, `pg42671.txt` is the first following input, `20` is the second,
and `5` is the third, so they should be put at the position of `$1`, `$2` and
`$3` respectively.**

### Q5. More fun with Linux

Try following commands in Bash and interpret the results: `cal`, `cal 2021`, `cal 9 1752` (anything unusual?), `date`, `hostname`, `arch`, `uname -a`, `uptime`, `who am i`, `who`, `w`, `id`, `last | head`, `echo {con,pre}{sent,fer}{s,ed}`, `time sleep 5`, `history | tail`.

### Answer

```{bash}
echo "Print the current date in the calendar form."
cal
```

```{bash}
echo "Print the calendar of 2021."
cal 2021
```

```{bash}
echo "Print the calendar of Sep, 1752."
cal 9 1752
```

```{bash}
echo "Print the current time and date."
date
```

```{bash}
echo "Print the current host's name."
hostname
```

```{bash}
echo "Print machine hardware name."
arch
```

```{bash}
echo "Print all system information."
uname -a
```

```{bash}
echo "No output for `who am i`."
who am i
```

```{bash}
echo "Print information about users who are currently logged in."
who
```

```{bash}
echo "Show who is logged on and what they are doing."
w
```

```{bash}
echo "Print user and group information for the specified USER, or (when USER 
omitted) for the current user."
id
```

**The following code will lead to an unstoppable process for the server, so I 
set it's `eval` value to be FALSE.**

```{bash eval=FALSE}
echo "`Last`  searches  back through the file /var/log/wtmp (or the file 
designated by the -f flag) and displays a list of all users logged in (and 
out) since that file was created. And `head` is to display the first ten 
records."
last | head -n 10
```


```{bash}
echo "Display all possible combinations of the element from each set, and only 
take one element from each set at the same time. And the combining order 
will follow the set order."
echo {con,pre}{sent,fer}{s,ed}
```

```{bash}
echo "Delay or pause for a specified amount of time, here is 5 seconds."
time sleep 5
```

**The following code will lead to an unstoppable process for the server, so I 
set it's `eval` value to be FALSE.**

```{bash eval=FALSE}
echo "With no options, `history` displays the command history list with line 
numbers. And `tail` is to display the last 10 lines."
history | tail
```